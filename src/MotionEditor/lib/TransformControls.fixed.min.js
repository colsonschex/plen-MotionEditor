(function(){"use strict";THREE.TransformGizmo=function(){var n=this;this.init=function(){var r,i,n,t;THREE.Object3D.call(this);this.planes=new THREE.Object3D;this.add(this.planes);r=new THREE.PlaneBufferGeometry(100,100);i=new THREE.MeshBasicMaterial({wireframe:!0});i.side=THREE.DoubleSide;n={XY:new THREE.Mesh(r,i),YZ:new THREE.Mesh(r,i),ZX:new THREE.Mesh(r,i)};this.activePlane=n.XY;n.YZ.rotation.set(0,Math.PI/2,0);n.ZX.rotation.set(-Math.PI/2,0,0);for(t in n)n[t].name=t,this.planes.add(n[t]),this.planes[t]=n[t],n[t].visible=!1;this.traverse(function(n){if(n instanceof THREE.Mesh){n.updateMatrix();var t=n.geometry.clone();t.applyMatrix(n.matrix);n.geometry=t;n.position.set(0,0,0);n.rotation.set(0,0,0);n.scale.set(1,1,1)}})}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.constructor=THREE.TransformGizmo;THREE.TransformGizmo.prototype.update=function(n){var t=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),r=new THREE.Matrix4;this.traverse(function(t){(t.name.search("X")!=-1||t.name.search("Y")!=-1||t.name.search("Z")!=-1)&&t.quaternion.setFromEuler(n)})};THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);this.setActivePlane=function(n){n=="X"&&(this.activePlane=this.planes.YZ);n=="Y"&&(this.activePlane=this.planes.ZX);n=="Z"&&(this.activePlane=this.planes.XY)};this.update=function(n,t){THREE.TransformGizmo.prototype.update.apply(this,arguments);var u=new THREE.Matrix4,f=new THREE.Euler(0,0,1),i=new THREE.Quaternion,h=new THREE.Vector3(1,0,0),c=new THREE.Vector3(0,1,0),l=new THREE.Vector3(0,0,1),e=new THREE.Quaternion,o=new THREE.Quaternion,s=new THREE.Quaternion,r=t.clone();f.copy(this.planes.XY.rotation);i.setFromEuler(f);u.makeRotationFromQuaternion(i).getInverse(u);r.applyMatrix4(u);this.traverse(function(n){i.setFromEuler(f);n.name=="X"&&(e.setFromAxisAngle(h,Math.atan2(-r.y,r.z)),i.multiplyQuaternions(i,e),n.quaternion.copy(i));n.name=="Y"&&(o.setFromAxisAngle(c,Math.atan2(r.x,r.z)),i.multiplyQuaternions(i,o),n.quaternion.copy(i));n.name=="Z"&&(s.setFromAxisAngle(l,Math.atan2(r.y,r.x)),i.multiplyQuaternions(i,s),n.quaternion.copy(i))})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate.prototype.constructor=THREE.TransformGizmoRotate;THREE.TransformControls=function(n,t){function pt(n){var t,r;if(i.object!==undefined&&l!==!0){if(n.preventDefault(),n.stopPropagation(),t=n.changedTouches?n.changedTouches[0]:n,t.button===0||t.button===undefined){if(i.axis="Y",i.update(),p.copy(o).sub(e).normalize(),i.gizmo[f].setActivePlane(i.axis,p),r=ot(t,[i.gizmo[f].activePlane]),r===!1)return;lt.copy(i.object.position);at.copy(i.object.scale);rt.extractRotation(i.object.matrix);ft.extractRotation(i.object.matrixWorld);vt.extractRotation(i.object.parent.matrixWorld);b.setFromMatrixScale(s.getInverse(i.object.parent.matrixWorld));g.copy(r.point)}l=!0}}function et(n){if(i.object!==undefined&&i.axis!==null&&l!==!1){n.preventDefault();n.stopPropagation();var t=n.changedTouches?n.changedTouches[0]:n,o=ot(t,[i.gizmo[f].activePlane]);r.copy(o.point);r.sub(e);r.multiply(b);u.copy(g).sub(e);u.multiply(b);i.space=="local"&&(r.applyMatrix4(s.getInverse(ft)),u.applyMatrix4(s),a.set(Math.atan2(r.z,r.y),Math.atan2(r.x,r.z),Math.atan2(r.y,r.x)),v.set(Math.atan2(u.z,u.y),Math.atan2(u.x,u.z),Math.atan2(u.y,u.x)),h.setFromRotationMatrix(rt),nt.setFromAxisAngle(st,a.x-v.x),tt.setFromAxisAngle(ht,a.y-v.y),it.setFromAxisAngle(ct,a.z-v.z),i.axis=="X"&&h.multiply(nt),i.axis=="Y"&&h.multiply(tt),i.axis=="Z"&&h.multiply(it),i.object.quaternion.copy(h),document.body.dispatchEvent(k));i.update()}}function c(){l=!1;i.detach()}function ot(i,r){var u=t.getBoundingClientRect(),e=(i.clientX-u.left)/u.width,s=(i.clientY-u.top)/u.height,f;return w.set(e*2-1,-(s*2)+1,.5),w.unproject(n),d.set(o,w.sub(o).normalize()),f=d.intersectObjects(r,!0),f[0]?f[0]:!1}THREE.Object3D.call(this);t=t!==undefined?t:document;this.gizmo={rotate:new THREE.TransformGizmoRotate};this.add(this.gizmo.rotate);this.object=undefined;this.space="local";this.size=1;this.axis=null;var i=this,l=!1,f="rotate",k=document.createEvent("Event");k.initEvent("angleChange",!0,!0);var d=new THREE.Raycaster,w=new THREE.Vector3,r=new THREE.Vector3,g=new THREE.Vector3,a=new THREE.Vector3,v=new THREE.Vector3,y=1,wt=new THREE.Matrix4,p=new THREE.Vector3,s=new THREE.Matrix4,u=new THREE.Vector3,bt=new THREE.Quaternion,st=new THREE.Vector3(1,0,0),ht=new THREE.Vector3(0,1,0),ct=new THREE.Vector3(0,0,1),h=new THREE.Quaternion,nt=new THREE.Quaternion,tt=new THREE.Quaternion,it=new THREE.Quaternion,kt=new THREE.Quaternion,lt=new THREE.Vector3,at=new THREE.Vector3,rt=new THREE.Matrix4,vt=new THREE.Matrix4,b=new THREE.Vector3,e=new THREE.Vector3,ut=new THREE.Euler,ft=new THREE.Matrix4,o=new THREE.Vector3,yt=new THREE.Euler;t.addEventListener("mousemove",et,!1);t.addEventListener("touchmove",et,!1);t.addEventListener("mouseup",c,!1);t.addEventListener("mouseout",c,!1);t.addEventListener("touchend",c,!1);t.addEventListener("touchcancel",c,!1);t.addEventListener("touchleave",c,!1);this.attach=function(n){i.object=n;i.update()};this.detach=function(){i.object=undefined;this.axis=null};this.setMode=function(n){f=n?n:f;f=="scale"&&(i.space="local");this.update()};this.setSpace=function(n){i.space=n;this.update()};this.update=function(){i.object!==undefined&&(i.object.updateMatrixWorld(),e.setFromMatrixPosition(i.object.matrixWorld),ut.setFromRotationMatrix(s.extractRotation(i.object.matrixWorld)),n.updateMatrixWorld(),o.setFromMatrixPosition(n.matrixWorld),yt.setFromRotationMatrix(s.extractRotation(n.matrixWorld)),y=e.distanceTo(o)/6*i.size,this.position.copy(e),this.scale.set(y,y,y),p.copy(o).sub(e).normalize(),this.gizmo[f].update(ut,p))};this.$onPointerDown=function(n){pt(n)}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformControls.prototype.constructor=THREE.TransformControls})();
//# sourceMappingURL=TransformControls.fixed.min.js.map
